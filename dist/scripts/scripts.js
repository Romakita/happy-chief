"use strict";angular.module("happyChiefApp",["ngCookies","ngResource","ngSanitize","ngRoute","mm.foundation"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/recipes-list.html",controller:"RecipeListCtrl"}).when("/recipes/:id",{templateUrl:"views/recipe.html",controller:"RecipeCtrl"}).when("/recipes/:page?/:limit?/:search?",{templateUrl:"views/recipes-list.html",controller:"RecipeListCtrl"}).otherwise({redirectTo:"/"})}]).controller("AppController",["$rootScope","$scope","Recipe",function(a,b,c){b.randomRecipes=[],c.randomList(8).success(function(a){b.randomRecipes=a}),b.$watch("search",function(){})}]).run(["$rootScope","$route","$location",function(a,b,c){console.log("run app"),a.$on("$viewContentLoaded",function(){console.log("$viewContentLoaded")});var d=c.path;c.path=function(e,f){if(f===!1)var g=b.current,h=a.$on("$locationChangeSuccess",function(){b.current=g,h()});return d.apply(c,[e])}}]),angular.module("happyChiefApp").service("Recipe",["$http",function(a){return{get:function(b){return a.get("/recipes/"+b)},save:function(b){return b._id?a.put("/recipes/"+b._id,b):a.post("/recipes",b)},remove:function(b){return a.delete("/recipes/"+b)},randomList:function(b){return a({url:"/recipes/random/"+(b||5),method:"GET"})},getList:function(b){return a({url:"/recipes",method:"GET",params:b})}}}]),angular.module("happyChiefApp").controller("CardsContainerController",["$scope","$attrs","$parse","$interpolate","$routeParams","$location","$sanitize",function(a,b,c,d,e,f){var g=this;if("undefined"!=typeof b.sortDefault){var h=b.sortDefault.split(" ");a.sortField=h[0],a.sortOrder=2==h.length?h[1]:"asc"}else a.sortField=!1,a.sortOrder=!1;a.paginations="undefined"!=typeof b.paginations?b.paginations.split(","):[20,50,100],a.totalItems=0,a.currentPage=e.page?e.page:1,a.maxSize=5,a.itemsPerPage=e.limit?e.limit:20,a.skip=(a.currentPage-1)*a.itemsPerPage,a.hidePagination=!0,a.havePicture=!1,a.totalPages=1,a.search=e.search?e.search:"",a.onChangeItemsPerPage=function(b){a.itemsPerPage=b,a.currentPage=1,g.setPath(),g.loadList()},this.loadList=function(){var b={limit:a.itemsPerPage,skip:a.skip,search:a.search,sortOrder:a.sortOrder,sortField:a.sortField,havePicture:a.havePicture};b=angular.extend(b,a.parameters||{}),a.loader(b).success(function(b){a.list1=[],a.list2=[];for(var c=0;c<b.data.length;c++)c%2==0?a.list1.push(b.data[c]):a.list2.push(b.data[c]);a.totalItems=b.maxLength,a.totalPages=Math.ceil(b.maxLength/a.itemsPerPage),a.showPagination=b.maxLength>a.itemsPerPage})},this.setPath=function(){f.path(a.href.replace("#","")+"/"+a.currentPage+"/"+a.itemsPerPage+(a.search?"/"+a.search:""),!1)},a.sanitize=function(a){var b="-",c=a.trim().replace(/ /g,b);c=encodeURIComponent(c),c=c.replace(/(%C3%A9)|(%C3%A8)|(%C3%AA)|(%C3%AB)/g,"e"),c=c.replace(/(%C3%A0)|(%C3%A4)|(%C3%A2)/g,"a"),c=c.replace(/(%C3%B9)|(%C3%BC)|(%C3%BB)/g,"u"),c=c.replace(/(%C3%BF)/g,"y"),c=c.replace(/(%C3%B2)|(%C3%B6)|(%C3%B4)/g,"o"),c=c.replace(/(%C3%A7)/g,"c"),c=c.replace(/%[A-F0-9]{0,2}/g,"");var d=new RegExp('/\\\\|\\/|\\||\\:|\\?|\\*|"|<|>|[[:cntrl:]]/',"g");return c=c.replace(d,b),c=c.replace(/[~'!\.]/g,""),c=c.replace(/--/g,"-"),c.toLowerCase()},a.onSelectPage=function(b){a.currentPage=b,a.skip=(a.currentPage-1)*a.itemsPerPage,g.setPath(),g.loadList()},a.$parent.$watch("search",function(){a.currentPage=1,a.search=a.$parent.search||"",a.havePicture=a.$parent.havePicture||"",a.skip=(a.currentPage-1)*a.itemsPerPage,g.loadList()}),a.$parent.$watch("havePicture",function(){a.currentPage=1,a.search=a.$parent.search||"",a.havePicture=a.$parent.havePicture||"",a.skip=(a.currentPage-1)*a.itemsPerPage,g.loadList()}),a.$watch("parameters",function(){g.loadList()})}]).controller("CardController",["$scope","$attrs",function(){}]).directive("cardsContainer",["$parse",function(){return{restrict:"EA",controller:"CardsContainerController",templateUrl:"views/recipe/cards-container.html",transclude:!0,scope:{href:"@",loader:"=",parameters:"="},replace:!0,link:function(){}}}]).directive("card",["$parse",function(){return{restrict:"EA",controller:"CardController",templateUrl:"views/recipe/card.html",transclude:!0,scope:{href:"@",item:"="},replace:!0,link:function(){}}}]),angular.module("happyChiefApp").controller("RecipeListCtrl",["$scope","Recipe",function(a,b){console.log("Recipes list"),a.loader=function(a){return console.log(a),b.getList(a).error(function(a){console.log(a)})}}]),angular.module("happyChiefApp").controller("RecipeCtrl",["$scope","$routeParams","Recipe",function(a,b,c){a.steps={},a.sanitize=function(a){return a.replace("<br />","").replace(/<br \/>$/,"")},b.id&&c.get(b.id).success(function(b){a.data=b,a.now=new Date;for(var c in a.data.ingredients){var d=a.data.ingredients[c];"undefined"==typeof a.steps[d.step]&&(a.steps[d.step]=[]),a.steps[d.step].push(d)}})}]),angular.module("happyChiefApp").directive("imageonload",function(){return{restrict:"A",link:function(a,b){b.bind("load",function(){b.addClass("loaded")})}}});